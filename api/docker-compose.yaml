version: '3.8'

services:
  # Serviço do backend
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: backend
    ports:
      - "5000:5000"  # Mapeia a porta do backend para a máquina local
    environment:
      - DB_HOST=${DB_HOST}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}  # Altere para sua senha de banco real
      - DB_NAME=${DB_NAME}  # Nome do banco de dados que você quer usar
      - DB_DIALECT=${DB_DIALECT}  # Ou 'postgres', se for PostgreSQL
      - JWT_SECRET=${JWT_SECRET}
    depends_on:
      - postgres-wanderer  # Garante que o banco de dados estará pronto antes de iniciar o backend
    volumes:
      - ./:/app  # Mapeia o código-fonte local para dentro do container
    networks:
      - app-network

  # Serviço do banco de dados
  postgres-wanderer:
    image: postgres:13         # Usando a imagem oficial do PostgreSQL
    container_name: postgres-wanderer
    environment:
      - POSTGRES_USER=postgres  # Usuário para o banco
      - POSTGRES_PASSWORD=postgres  # Senha do banco
      - POSTGRES_DB=wanderer    # Nome do banco de dados
    ports:
      - "5432:5432"  # Porta do banco de dados
    volumes:
      - wanderer-db-data:/var/lib/postgresql/data  # Persistência dos dados do banco
    networks:
      - app-network

volumes:
  wanderer-db-data:  # Volume persistente para os dados do banco de dados

networks:
  app-network:
    driver: bridge
